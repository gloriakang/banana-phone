install.packages(c("lazyeval", "plyr", "tidyr"))
install.packages("foreign")
install.packages("tidyr")
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
# read data and names
data <- read.csv("surveydata.csv")
varlabels <- read.csv("varlabels.csv", header = FALSE)
data2 <- data %>%
# Q7
rename("Q7_1_Bus" = Q7_1,
"Q7_2_Carpool" = Q7_2,
"Q7_3_Subway" = Q7_3,
"Q7_4_Train" = Q7_4,
"Q7_5_Taxi" = Q7_5,
"Q7_6_Airplane" = Q7_6,
"Q7_7_Other" = Q7_7,
"Q7_8_Refused" = Q7_8) %>%
# Q8
rename("Q8_1_Work" = Q8_1,
"Q8_2_School" = Q8_2,
"Q8_3_Shopping" = Q8_3,
"Q8_4_Visiting people" = Q8_4,
"Q8_5_Recreation" = Q8_5,
"Q8_6_Other" = Q8_6,
"Q8_7_Refused"= Q8_7) %>%
# Q10
rename("Q10_1_Bus" = Q10_1,
"Q10_2_Carpool" = Q10_2,
"Q10_3_Subway" = Q10_3,
"Q10_4_Train" = Q10_4,
"Q10_5_Taxi" = Q10_5,
"Q10_6_Airplane" = Q10_6,
"Q10_7_Don_t know" = Q10_7,
"Q10_8_Other" = Q10_8,
"Q10_9_Refused" = Q10_9) %>%
# Q11
rename("Q11_1_Work" = Q11_1,
"Q11_2_Schools" = Q11_2,
"Q11_3_Day care" = Q11_3,
"Q11_4_Stores" = Q11_4,
"Q11_5_Restaurants" = Q11_5,
"Q11_6_Libraries" = Q11_6,
"Q11_7_Hospitals" = Q11_7,
"Q11_8_Doctor_s office" = Q11_8,
"Q11_9_Public transportation" = Q11_9,
"Q11_10_Family or friends" = Q11_10,
"Q11_11_Other" = Q11_11) %>%
# Q12
rename("Q12_1_Avoid touching my eyes" = Q12_1,
"Q12_2_Avoid touching my nose" = Q12_2,
"Q12_3_Avoid touching my mouth" =	Q12_3,
"Q12_4_Wash my hands with soap more often"= Q12_4,
"Q12_5_Use hand sanitizers" = Q12_5,
"Q12_6_Clean the surfaces in my home" =	Q12_6,
"Q12_7_Clean the surfaces at work" = Q12_7,
"Q12_8_Eat nutritious food" = Q12_8,
"Q12_9_Get adequate rest" = Q12_9,
"Q12_10_Get recommended vaccine" =	Q12_10,
"Q12_11_Take preventive medicine" = Q12_11,
"Q12_12_Cover my nose and mouth with a surgical mask" = Q12_12,
"Q12_13_Avoid contact with people who are sick" = Q12_13,
"Q12_14_Avoid crowded places" = Q12_14,
"Q12_15_Other" = Q12_15) %>%
# Q18
rename("Q18_1_The vaccine costs too much" = Q18_1,
"Q18_2_The vaccine is not very effective in preventing influenza" = Q18_2,
"Q18_3_I am not likely to get influenza" = Q18_3,
"Q18_4_Do not know where to get vaccine" = Q18_4,
"Q18_5_The side effect of the vaccine are too risky" = Q18_5,
"Q18_6_I am allergic to some of the ingredients in the vaccine" = Q18_6,
"Q18_7_I do not like shots" = Q18_7,
"Q18_8_I just don_t get around to doing it" = Q18_8,
"Q18_9_I have to travel too far to get vaccine" = Q18_9,
"Q18_10_Other" = Q18_10,
"Q18_11_Refused" = Q18_11) %>%
# Q22
rename("Q22_1_Go to a doctor_s office or medical clinic" = Q22_1,
"Q22_2_Decide on treatment without consulting a health practitioner" = Q22_2,
"Q22_3_Search the internet for a treatment" = Q22_3,
"Q22_4_Get adequate sleep" = Q22_4,
"Q22_5_Eat nutritious food" = Q22_5,
"Q22_6_Take-over-counter medication for symptoms" = Q22_6,
"Q22_7_Take an antiviral medicine" = Q22_7,
"Q22_8_Take no action to treat the illness" = Q22_8,
"Q22_9_Other" = Q22_9) %>%
# Q23
rename("Q23_1_Stand away from people" = Q23_1,
"Q23_2_Avoid public places" = Q23_2,
"Q23_3_Avoid public transportation" = Q23_3,
"Q23_4_Stay at home" = Q23_4,
"Q23_5_Wash my hands with soap more often" = Q23_5,
"Q23_6_Use hand sanitizers" = Q23_6,
"Q23_7_Clean the surfaces in my home" = Q23_7,
"Q23_8_Clean the surfaces I use at work" = Q23_8,
"Q23_9_Cover my nose and mouth with a surgical mask" = Q23_9,
"Q23_10_Cover my nose and mouth when I sneeze or cough" = Q23_10,
"Q23_11_Other" = Q23_11) %>%
# Q24
rename("Q24_1_Print media such as newspapers and magazines" = Q24_1,
"Q24_2_Traditional media such as television and radio" = Q24_2,
"Q24_3_Social media such as internet and blogs" = Q24_3,
"Q24_4_Word of mouth" = Q24_4,
"Q24_5_None" = Q24_5,
"Q24_6_Other" = Q24_6,
"Q24_7_Refused" = Q24_7) %>%
# Q25
rename("Q25_1_Stand away from people" = Q25_1,
"Q25_2_Avoid public places" = Q25_2,
"Q25_3_Avoid public transportation" = Q25_3,
"Q25_4_Stay at home" = Q25_4,
"Q25_5_Wash my hands with soap more often" = Q25_5,
"Q25_6_Use hand sanitizers" = Q25_6,
"Q25_7_Clean the surfaces in my home" = Q25_7,
"Q25_8_Clean the surfaces I use at work" = Q25_8,
"Q25_9_Cover my nose and mouth with a surgical mask" = Q25_9,
"Q25_10_Cover my nose and mouth when I sneeze or cough" = Q25_10,
"Q25_11_Other" = Q25_11) %>%
# Q27
rename("Q27_1_Keep the child away from the others in the residence" = Q27_1,
"Q27_2_Keep the child out of school/daycare" = Q27_2,
"Q27_3_Stop child_s social activities like play dates" =	Q27_3,
"Q27_4_Other" = Q27_4) %>%
# Q29
rename("Q29_1_A parent brings the child to work" = Q29_1,
"Q29_2_A parent stays home" = Q29_2,
"Q29_3_Another adult stays home" = Q29_3,
"Q29_4_Send the child to school sick" = Q29_4,
"Q29_5_Take the child to a relative or friends" =	Q29_5,
"Q29_6_Other" = Q29_6) %>%
# Q30
rename("Q30_1_I bring the child to work" = Q30_1,
"Q30_2_I stay home" = Q30_2,
"Q30_3_Another adult stays home" = Q30_3,
"Q30_4_Send the child to school sick" = Q30_4,
"Q30_5_Take the child to a relative or friends" = Q30_5,
"Q30_6_Other" = Q30_6)
write.csv(data2, file = "surveydata2.csv", row.names = FALSE)
knitr::opts_chunk$set(echo = TRUE)
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
#library(foreign)
# weighted data
data <- read.csv("surveydata.csv", na = c("#NULL!", "", "Refused"))
# renamed cols
data2 <- read.csv("surveydata2.csv", na = c("#NULL!", "", "Refused"))
# unweighted data -- what is the difference?
#data_unw <- read.csv("surveydata_unw.csv", na = c("#NULL!", ""))
#data_unw <- read.spss("datafile.sav", to.data.frame = TRUE)
with(data, prop.table(table(Q1)))
with(data, table(Q1, Q2))
with(data, by(Q1, Q2, summary))
with(data, prop.table(table(Q1, Q2)))
with(data, prop.table(table(Q1, Q2), margin = 2))
with(data, prop.table(table(Q1, Q2), margin = 1))
with(data, prop.table(table(Q1, Q2)))
with(data, prop.table(table(Q1, Q2), margin = 1))
with(data, prop.table(table(Q1, Q2), margin = 2))
with(data, by(Q1, PPGENDER, summary))
with(data, table(Q1, Q2))
with(data, table(Q1, PPGENDER))
with(data, prop.table(table(Q1, PPGENDER), margin = 1))
with(data, prop.table(table(Q1, PPGENDER), margin = 2))
with(data, prop.table(table(PPGENDER, Q1), margin = 1))
with(data, prop.table(table(PPGENDER, Q1), margin = 2))
with(data, table(Q1, PPGENDER))
with(data, table(Q2, Q3))
test <- filter(data, Q2=='Yes', Q3=='Yes')
with(test, table(PPGENDER))
class(test)
a = with(test, table(PPGENDER))
class(a)
a
table(test$PPGENDER)
b = table(test$PPGENDER)
b
class(b)
as.data.frame(b)
class(b)
b = as.data.frame(b)
class(b)
# Q1 table
with(data, table(Q1))
q1 <- data %>%
group_by(Q1) %>%
count(Q1)
ggplot(q1, aes(x = Q1, y = n, fill = Q1)) + geom_bar(stat = 'identity')
class(q1)
q1
with(data, table(Q1))
with(data, summary(Q31))
with(data, by(Q31, PPGENDER, summary))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
#library(foreign)
# weighted data
data <- read.csv("surveydata.csv", na = c("#NULL!", "", "Refused"))
# renamed cols
data2 <- read.csv("surveydata2.csv", na = c("#NULL!", "", "Refused"))
# unweighted data -- what is the difference?
#data_unw <- read.csv("surveydata_unw.csv", na = c("#NULL!", ""))
#data_unw <- read.spss("datafile.sav", to.data.frame = TRUE)
# Chunk 5
# Q1 table
with(data, table(Q1))
q1 <- data %>%
group_by(Q1) %>%
count(Q1)
ggplot(q1, aes(x = Q1, y = n, fill = Q1)) + geom_bar(stat = 'identity')
# by gender
with(data, table(Q1, PPGENDER))
q1 <- data %>%
group_by(Q1, PPGENDER) %>%
count(Q1, PPGENDER)
ggplot(q1, aes(x = Q1, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data, table(Q1, PPETHM))
q1 <- data %>%
group_by(Q1, PPETHM) %>%
count(Q1, PPETHM)
ggplot(q1, aes(x = Q1, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data, table(Q1, PPINCIMP))
q1 <- data %>%
group_by(Q1, PPINCIMP) %>%
count(Q1, PPINCIMP)
ggplot(q1, aes(x = Q1, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 6
# all
with(data, table(Q2))
q2 <- data %>%
group_by(Q2) %>%
count(Q2)
ggplot(q2, aes(x = Q2, y = n, fill = Q2)) + geom_bar(stat = 'identity')
# by gender
with(data, table(Q2, PPGENDER))
q2 <- data %>%
group_by(Q2, PPGENDER) %>%
count(Q2, PPGENDER)
ggplot(q2, aes(x = Q2, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data, table(Q2, PPETHM))
q2 <- data %>%
group_by(Q2, PPETHM) %>%
count(Q2, PPETHM)
ggplot(q2, aes(x = Q2, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data, table(Q2, PPINCIMP))
q2 <- data %>%
group_by(Q2, PPINCIMP) %>%
count(Q2, PPINCIMP)
ggplot(q2, aes(x = Q2, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 7
# all
with(data, table(Q3))
q3 <- data %>%
group_by(Q3) %>%
count(Q3)
ggplot(q3, aes(x = Q3, y = n, fill = Q3)) + geom_bar(stat = 'identity')
# by gender
with(data, table(Q3, PPGENDER))
q3 <- data %>%
group_by(Q3, PPGENDER) %>%
count(Q3, PPGENDER)
ggplot(q3, aes(x = Q3, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data, table(Q3, PPETHM))
q3 <- data %>%
group_by(Q3, PPETHM) %>%
count(Q3, PPETHM)
ggplot(q3, aes(x = Q3, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data, table(Q3, PPINCIMP))
q3 <- data %>%
group_by(Q3, PPINCIMP) %>%
count(Q3, PPINCIMP)
ggplot(q3, aes(x = Q3, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 8
# all
with(data, table(Q4))
q4 <- data %>%
group_by(Q4) %>%
count(Q4)
ggplot(q4, aes(x = Q4, y = n, fill = Q4)) + geom_bar(stat = 'identity')
# by gender
with(data, table(Q4, PPGENDER))
q4 <- data %>%
group_by(Q4, PPGENDER) %>%
count(Q4, PPGENDER)
ggplot(q4, aes(x = Q4, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data, table(Q4, PPETHM))
q4 <- data %>%
group_by(Q4, PPETHM) %>%
count(Q4, PPETHM)
ggplot(q4, aes(x = Q4, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data, table(Q4, PPINCIMP))
q4 <- data %>%
group_by(Q4, PPINCIMP) %>%
count(Q4, PPINCIMP)
ggplot(q4, aes(x = Q4, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 9
# all
with(data, table(Q5))
q5 <- data %>%
group_by(Q5) %>%
count(Q5)
ggplot(q5, aes(x = Q5, y = n, fill = Q5)) + geom_bar(stat = 'identity')
# by gender
with(data, table(PPGENDER, Q5))
q5 <- data %>%
group_by(Q5, PPGENDER) %>%
count(Q5, PPGENDER)
ggplot(q5, aes(x = Q5, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
q5 <- data %>%
group_by(Q5, PPETHM) %>%
count(Q5, PPETHM)
ggplot(q5, aes(x = Q5, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
q5 <- data %>%
group_by(Q5, PPINCIMP) %>%
count(Q5, PPINCIMP)
ggplot(q5, aes(x = Q5, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 10
# all
with(data, table(Q6))
q6 <- data %>%
group_by(Q6) %>%
count(Q6)
ggplot(q6, aes(x = Q6, y = n, fill = Q6)) + geom_bar(stat = 'identity')
# by gender
# with(data, table(PPGENDER, Q6))
(q6 <- data %>%
group_by(Q6, PPGENDER) %>%
count(Q6, PPGENDER)
)
ggplot(q6, aes(x = Q6, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
(q6 <- data %>%
group_by(Q6, PPETHM) %>%
count(Q6, PPETHM)
)
ggplot(q6, aes(x = Q6, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
(q6 <- data %>%
group_by(Q6, PPINCIMP) %>%
count(Q6, PPINCIMP)
)
ggplot(q6, aes(x = Q6, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 11
Q7 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q7_1_Bus:Q7_otherText) %>%
gather("q", "r", Q7_1_Bus:Q7_7_Other)
# all
with(Q7, table(q, r))
q7 <- Q7 %>%
group_by(q, r) %>%
count(q, r)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = r)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# by gender
# with(Q7, table(PPGENDER, r, q))
(q7 <- Q7 %>%
group_by(PPGENDER, q, r) %>%
count(PPGENDER, q, r)
)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# by ethnicity
# with(Q7, table(PPETHM, r, q))
(q7 <- Q7 %>%
group_by(PPETHM, q, r) %>%
count(PPETHM, q, r)
)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# by income
# with(Q7, table(q, r, PPINCIMP))
(q7 <- Q7 %>%
group_by(PPINCIMP, q, r) %>%
count(PPINCIMP, q, r)
)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# Chunk 12
Q8 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q8_1_Work:Q8_otherText) %>%
gather("q", "r", Q8_1_Work:Q8_6_Other)
# Chunk 13
# Chunk 14
Q11 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q11_1_Work:Q11_OtherText_Codes) %>%
gather("q", "r", Q11_1_Work:Q11_11_Other)
# all
with(Q11, table(q, r))
q11 <- Q11 %>%
group_by(q, r) %>%
count(q, r)
ggplot(q1[!is.na(q11$r), ], aes(x = r, y = n, fill = r)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# by gender
# with(Q7, table(PPGENDER, r, q))
(q11 <- Q11 %>%
group_by(PPGENDER, q, r) %>%
count(PPGENDER, q, r)
)
ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# by ethnicity
# with(Q7, table(PPETHM, r, q))
(q11 <- Q11 %>%
group_by(PPETHM, q, r) %>%
count(PPETHM, q, r)
)
ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# by income
# with(Q7, table(q, r, PPINCIMP))
(q11 <- Q11 %>%
group_by(PPINCIMP, q, r) %>%
count(PPINCIMP, q, r)
)
ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
# Chunk 15
Q12 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 75:91) %>%
gather("q", "r", Q12_1_Avoid.touching.my.eyes:Q12_15_Other)
# Chunk 16
# Chunk 17
with(data, summary(Q14))
# by gender
with(data, by(Q14, PPGENDER, summary))
# Chunk 18
# Chunk 19
# Chunk 20
# Chunk 21
# Chunk 22
# Chunk 23
# Chunk 24
# Chunk 25
# Chunk 26
# Chunk 27
# Chunk 28
# Chunk 29
# Chunk 30
# Chunk 31
# Chunk 32
# Chunk 33
# Chunk 34
with(data, summary(Q31))
# by gender
with(data, by(Q31, PPGENDER, summary))
# Chunk 35
with(data, summary(Q32))
# by gender
with(data, by(Q33, PPGENDER, summary))
# Chunk 36
with(data, summary(Q33))
# by ethnicity
with(data, by(Q33, PPETHM, summary))
# Chunk 37
# Chunk 38
# Chunk 39
# Chunk 40
# Chunk 41
# Chunk 42
# Chunk 43
# Chunk 44
# Chunk 45
# Chunk 46
# Chunk 47
# Chunk 48
# Chunk 49
# Chunk 50
# Chunk 51
# Chunk 52
Q11 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q11_1_Work:Q11_OtherText_Codes) %>%
gather("q", "r", Q11_1_Work:Q11_11_Other)
Q11
View(Q11)
with(data, prop.table(table(Q1)))
