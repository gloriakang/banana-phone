#  select(starts_with("Q11_")) %>%
#  select(-contains("Text")) %>%  # prob don't need this
#  names()
q11.lab <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know")
data1$Q11_1 <- factor(data1$Q11_1, levels = q11.lab)
data1$Q11_2 <- factor(data1$Q11_2, levels = q11.lab)
data1$Q11_3 <- factor(data1$Q11_3, levels = q11.lab)
data1$Q11_4 <- factor(data1$Q11_4, levels = q11.lab)
data1$Q11_5 <- factor(data1$Q11_5, levels = q11.lab)
data1$Q11_6 <- factor(data1$Q11_6, levels = q11.lab)
data1$Q11_7 <- factor(data1$Q11_7, levels = q11.lab)
data1$Q11_8 <- factor(data1$Q11_8, levels = q11.lab)
data1$Q11_9 <- factor(data1$Q11_9, levels = q11.lab)
data1$Q11_10 <- factor(data1$Q11_10, levels = q11.lab)
data1$Q11_11 <- factor(data1$Q11_11, levels = q11.lab)
data1$Q13
levels(data1$Q13)
data1$Q13 <- factor(data1$Q13, levels = c("Yes, every year", "Yes, some years", "No, never"))
data1$Q14 <- factor(data1$Q14, levels = c("$0", "Less than $30", "$30 to $60", "More than $60", "Don_t know"))
data1$Q20 <- factor(data1$Q20, levels = c("Very effective", "Somewhat effective", "It varies from season to season", "Not effective", "Don_t know"))
data1$Q21 <- factor(data1$Q21, levels = c("Yes, the full cost is paid", "Yes, but only part of the cost is paid", "No", "Don_t know"))
data1$Q39 <- factor(data1$Q39, levels = c("More than once per year", "Once per year", "Less than once per year", "Never", "Don_t know"))
data1$Q40 <- factor(data1$Q40, levels = c("Never", "1 to 2 times", "3 to 5 times", "6 to 10 times", "More than 10", "Don_t know"))
data1$Q41 <- factor(data1$Q41, levels = c("Never", "Once", "2 times", "3 times", "More than 3", "Don_t know"))
data1$Q42 <- factor(data1$Q42, levels = c("Yes, always", "Yes, sometimes", "No, never", "Don_t know"))
data1$Q47 <- factor(data1$Q47, levels = c("More than once per year", "Once per year", "Less than once per year", "Never", "Don_t know"))
data1$Q48 <- factor(data1$Q48, levels = c("Never", "1 to 2 times", "3 to 5 times", "6 to 10 times", "More than 10", "Don_t know"))
levels(data1$Q48)
data1$Q49 <- factor(data1$Q49, levels = c("Never", "Once", "2 times", "3 times", "More than 3", "Don_t know"))
data1$Q50 <- factor(data1$Q50, levels = c("Yes, always", "Yes, sometimes", "No, never", "Don_t know"))
##### ----- save r object ----- #####
# apply new names
names(data1) <- new_name
data2 <- data1
save(data2, new_name, old_name, file = "clean/all.Rdata")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
rm(list = ls())
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
load("clean/all.Rdata")
# set new names
names(data2) <- new_name
# Chunk 2
# Q1
with(data2, table(Q1))
q1 <- data2 %>%
count(Q1)
# plot
ggplot(data2[!is.na(data2$Q1), ]) + geom_bar(mapping = aes(x = Q1, fill = Q1))
# alternative plot:
#ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
#  geom_bar(stat = 'identity', position = position_dodge())
# by gender, PPGENDER
with(data2, table(PPGENDER, Q1))
q1 <- data2 %>%
count(Q1, PPGENDER)
# plot
ggplot(data2[!is.na(data2$Q1), ]) + geom_bar(mapping = aes(x = Q1, fill = PPGENDER), position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPGENDER)
# by ethnicity, PPETHM
with(data2, table(PPETHM, Q1))
q1 <- data2 %>%
count(Q1, PPETHM)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPETHM)
# by income, PPINCIMP
with(data2, table(PPINCIMP, Q1))
q1 <- data2 %>%
count(Q1, PPINCIMP)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPINCIMP)
# Chunk 3
with(data2, table(Q2))
q2 <- data2 %>%
count(Q2)
ggplot(q2, aes(x = Q2, y = n, fill = Q2)) + geom_bar(stat = 'identity')
# by gender
with(data2, table(Q2, PPGENDER))
q2 <- data2 %>%
count(Q2, PPGENDER)
ggplot(q2, aes(x = Q2, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data2, table(Q2, PPETHM))
q2 <- data2 %>%
count(Q2, PPETHM)
ggplot(q2, aes(x = Q2, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data2, table(PPINCIMP, Q2))
q2 <- data2 %>%
count(Q2, PPINCIMP)
ggplot(q2, aes(x = Q2, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 4
# all
with(data2, table(Q3))
q3 <- data2 %>%
count(Q3)
ggplot(q3, aes(x = Q3, y = n, fill = Q3)) + geom_bar(stat = 'identity')
# by gender
with(data2, table(Q3, PPGENDER))
q3 <- data2 %>%
count(Q3, PPGENDER)
ggplot(q3, aes(x = Q3, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data2, table(Q3, PPETHM))
q3 <- data2 %>%
count(Q3, PPETHM)
ggplot(q3, aes(x = Q3, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data2, table(PPINCIMP, Q3))
q3 <- data2 %>%
count(Q3, PPINCIMP)
ggplot(q3, aes(x = Q3, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 5
# all
with(data2, table(Q4))
q4 <- data2 %>%
count(Q4)
ggplot(q4, aes(x = Q4, y = n, fill = Q4)) + geom_bar(stat = 'identity') +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# by gender
with(data2, table(Q4, PPGENDER))
q4 <- data2 %>%
count(Q4, PPGENDER)
ggplot(q4, aes(x = Q4, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge()) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# by ethnicity
with(data2, table(PPETHM, Q4))
q4 <- data2 %>%
count(Q4, PPETHM)
ggplot(q4, aes(x = Q4, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge()) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# by income
with(data2, table(PPINCIMP, Q4))
q4 <- data2 %>%
count(Q4, PPINCIMP)
ggplot(q4, aes(x = Q4, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge()) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Chunk 6
# all
with(data2, table(Q5))
q5 <- data2 %>%
count(Q5)
ggplot(q5, aes(x = Q5, y = n, fill = Q5)) + geom_bar(stat = 'identity')
# by gender
with(data2, table(PPGENDER, Q5))
q5 <- data2 %>%
count(Q5, PPGENDER)
ggplot(q5, aes(x = Q5, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data2, table(PPETHM, Q5))
q5 <- data2 %>%
count(Q5, PPETHM)
ggplot(q5, aes(x = Q5, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data2, table(PPINCIMP, Q5))
q5 <- data2 %>%
count(Q5, PPINCIMP)
ggplot(q5, aes(x = Q5, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 7
with(data2, table(Q6))
q6 <- data2 %>%
count(Q6)
ggplot(q6, aes(x = Q6, y = n, fill = Q6)) + geom_bar(stat = 'identity')
# by gender
with(data2, table(PPGENDER, Q6))
q6 <- data2 %>%
count(Q6, PPGENDER)
ggplot(q6, aes(x = Q6, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by ethnicity
with(data2, table(PPETHM, Q6))
q6 <- data2 %>%
count(Q6, PPETHM)
ggplot(q6, aes(x = Q6, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# by income
with(data2, table(PPINCIMP, Q6))
q6 <- data2 %>%
count(Q6, PPINCIMP)
ggplot(q6, aes(x = Q6, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 8
# look at patterned names
# grep("Q7", names(data2))
# make long data
q7_long <- data2 %>%
gather("Q7_q", "Q7_r", starts_with("Q7_"), -contains("Text"), -contains("Refused"), na.rm = TRUE)
#grep("Q7", names(q7_long))
#View(q7_long[c(1, 34, 35, 423:424)])
with(q7_long, table(Q7_q, Q7_r))
q7 <- q7_long %>%
count(Q7_q, Q7_r)
# flip coordinates
ggplot(q7[!is.na(q7$Q7_r), ], aes(x = Q7_r, y = n, fill = Q7_r)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q7_q) + coord_flip()
# by gender
with(q7_long, table(PPGENDER, Q7_q, Q7_r))
q7 <- q7_long %>%
group_by(PPGENDER, Q7_q, Q7_r) %>%
count(PPGENDER, Q7_q, Q7_r)
ggplot(q7[!is.na(q7$Q7_r), ], aes(x = Q7_r, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q7_q)
# by ethnicity
with(q7_long, table(PPETHM, Q7_q, Q7_r))
q7 <- q7_long %>%
group_by(PPETHM, Q7_q, Q7_r) %>%
count(PPETHM, Q7_q, Q7_r)
ggplot(q7[!is.na(q7$Q7_r), ], aes(x = Q7_r, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q7_q)
# by income
with(q7_long, table(PPINCIMP, Q7_q, Q7_r ))
q7 <- q7_long %>%
group_by(PPINCIMP, Q7_q, Q7_r) %>%
count(PPINCIMP, Q7_q, Q7_r)
ggplot(q7[!is.na(q7$Q7_r), ], aes(x = Q7_r, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q7_q)
# Chunk 9
q8_long <- data2 %>%
gather("Q8_q", "Q8_r", starts_with("Q8_"), -contains("otherText"), -contains("Refused"))
with(q8_long, table(Q8_q, Q8_r))
q8 <- q8_long %>%
count(Q8_q, Q8_r)
# PPGENDER
with(q8_long, table(PPGENDER, Q8_q, Q8_r))
q8 <- q8_long %>%
group_by(PPGENDER, Q8_q, Q8_r) %>%
count(PPGENDER, Q8_q, Q8_r)
# PPETHM
with(q8_long, table(PPETHM, Q8_q, Q8_r))
# PPINCIMP
with(q8_long, table(PPINCIMP, Q8_q, Q8_r))
# Chunk 10
with(data2, table(Q9))
# Chunk 11
#Q10 <- data2 %>%
#  select(CaseID, PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, #Q10_1_Bus:Q10_9_Refused) %>%
#  gather("Q10_q", "Q10_r", Q10_1_Bus:Q10_8_Other)
q10_long <- data2 %>%
gather("Q10_q", "Q10_r", starts_with("Q10_"), -contains("Text"), -contains("Refused"), na.rm = TRUE)
with(q10_long, table(Q10_q, Q10_r))
q10 <- q10_long %>%
count(Q10_q, Q10_r)
# PPGENDER
with(q10_long, table(PPGENDER, Q10_q, Q10_r))
q10 <- q10_long %>%
group_by(PPGENDER, Q10_q, Q10_r) %>%
count(PPGENDER, Q10_q, Q10_r)
# PPETHM
with(q10_long, table(PPETHM, Q10_q, Q10_r))
# PPINCIMP
with(q10_long, table(PPINCIMP, Q10_q, Q10_r))
# Chunk 12
q11_long <- data2 %>%
gather("Q11_q", "Q11_r", starts_with("Q11_"), -contains("Text"), -contains("Refused"), na.rm = TRUE)
with(q11_long, table(Q11_q, Q11_r))
q11 <- q11_long %>%
count(Q11_q, Q11_r)
ggplot(q11[!is.na(q11$Q11_r), ], aes(x = Q11_r, y = n, fill = Q11_r)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q11_q) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# by gender
with(q11_long, table(PPGENDER, Q11_r, Q11_q))
q11 <- q11_long %>%
group_by(PPGENDER, Q11_q, Q11_r) %>%
count(PPGENDER, Q11_q, Q11_r)
ggplot(q11[!is.na(q11$Q11_r), ], aes(x = Q11_r, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q11_q) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# by ethnicity
with(q11_long, table(PPETHM, Q11_r, Q11_q))
q11 <- q11_long %>%
group_by(PPETHM, Q11_q, Q11_r) %>%
count(PPETHM, Q11_q, Q11_r)
ggplot(q11[!is.na(q11$Q11_r), ], aes(x = Q11_r, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q11_q) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# by income
with(q11_long, table(PPINCIMP, Q11_q, Q11_r))
q11 <- q11_long %>%
group_by(PPINCIMP, Q11_q, Q11_r) %>%
count(PPINCIMP, Q11_q, Q11_r)
ggplot(q11[!is.na(q11$Q11_r), ], aes(x = Q11_r, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q11_q) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Chunk 13
Q12 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 75:91) %>%
gather("q", "r", 7:21)
with(Q12, table(q, r))
q12 <- Q12 %>%
count(q, r)
# Chunk 14
with(data2, table(Q13))
ggplot(data2[!is.na(data2$Q13), ]) + geom_bar(mapping = aes(x = Q13, fill = Q13), position = position_dodge())
# by gender
with(data2, table(Q13, PPGENDER))
q13 <- data2 %>%
count(Q13, PPGENDER)
ggplot(q13[!is.na(q13$Q13), ], aes(x = Q13, y = n, fill = PPGENDER)) +
geom_bar(stat = 'identity', position = position_dodge())
# by eth
with(data2, table(Q13, PPINCIMP))
q13 <- data2 %>%
count(Q13, PPINCIMP)
ggplot(q13[!is.na(q13$Q13), ], aes(x = Q13, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# Chunk 15
with(data2, table(Q14))
ggplot(data2[!is.na(data2$Q14), ]) + geom_bar(mapping = aes(x = Q14, fill = Q14), position = position_dodge())
# by gender
with(data2, by(Q14, PPGENDER, summary))
# Chunk 16
with(data2, table(Q15))
ggplot(data2[!is.na(data2$Q15), ]) + geom_bar(mapping = aes(x = Q15, fill = Q15), position = position_dodge())
#
with(data2, table(Q15, PPGENDER))
#
with(data2, table(Q15, PPETHM))
#
with(data2, table(PPINCIMP, Q15))
# Chunk 17
with(data2, table(Q16))
ggplot(data2[!is.na(data2$Q16), ]) + geom_bar(mapping = aes(x = Q16, fill = Q16), position = position_dodge())
#
with(data2, table(Q16, PPGENDER))
#
with(data2, table(Q16, PPETHM))
#
with(data2, table(PPINCIMP, Q16))
# Chunk 18
with(data2, table(Q17))
ggplot(data2[!is.na(data2$Q17), ]) + geom_bar(mapping = aes(x = Q17, fill = Q17), position = position_dodge())
#
with(data2, table(Q17, PPGENDER))
#
with(data2, table(Q17, PPETHM))
#
with(data2, table(PPINCIMP, Q17))
# Chunk 19
Q18 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 97:108) %>%
gather("q", "r", 7:Q18_10_Other)
with(Q18, table(q, r))
q18 <- Q18 %>%
count(q, r)
# Chunk 20
with(data2, table(Q19))
ggplot(data2[!is.na(data2$Q19), ]) + geom_bar(mapping = aes(x = Q19, fill = Q19), position = position_dodge())
#
with(data2, table(Q19, PPGENDER))
#
with(data2, table(Q19, PPETHM))
#
with(data2, table(PPINCIMP, Q19))
# Chunk 21
with(data2, table(Q20))
ggplot(data2[!is.na(data2$Q20), ]) + geom_bar(mapping = aes(x = Q20, fill = Q20), position = position_dodge())
#
with(data2, table(Q20, PPGENDER))
#
with(data2, table(Q20, PPETHM))
#
with(data2, table(PPINCIMP, Q20))
# Chunk 22
with(data2, table(Q21))
ggplot(data2[!is.na(data2$Q21), ]) + geom_bar(mapping = aes(x = Q21, fill = Q21), position = position_dodge())
#
with(data2, table(Q21, PPGENDER))
#
with(data2, table(Q21, PPETHM))
#
with(data2, table(PPINCIMP, Q21))
# Chunk 23
Q22 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 112:122) %>%
gather("q", "r", 7:Q22_9_Other)
with(Q22, table(q, r))
q22 <- Q22 %>%
count(q, r)
# Chunk 24
Q23 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 123:Q23_11_Other) %>%
gather("q", "r", 7:Q23_11_Other)
with(Q23, table(q, r))
q23 <- Q23 %>%
count(q, r)
# Chunk 25
Q24 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 137:Q24_7_Refused) %>%
gather("q", "r", 7:Q24_6_Other)
with(Q24, table(q, r))
q24 <- Q24 %>%
count(q, r)
# Chunk 26
Q25 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 145:Q25_11_Other) %>%
gather("q", "r", 7:Q25_11_Other)
with(Q25, table(q, r))
q25 <- Q25 %>%
count(q, r)
# Chunk 27
with(data2, table(Q26))
ggplot(data2[!is.na(data2$Q26), ]) + geom_bar(mapping = aes(x = Q26, fill = Q26), position = position_dodge())
# Chunk 28
Q27 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 159:Q27_4_Other) %>%
gather("q", "r", 7:Q27_4_Other)
with(Q27, table(q, r))
q27 <- Q27 %>%
count(q, r)
# Chunk 29
with(data2, table(Q28))
ggplot(data2[!is.na(data2$Q28), ]) + geom_bar(mapping = aes(x = Q28, fill = Q28), position = position_dodge())
# Chunk 30
Q29 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 166:Q29_6_Other) %>%
gather("q", "r", 7:Q29_6_Other)
with(Q29, table(q, r))
q29 <- Q29 %>%
count(q, r)
# Chunk 31
Q30 <- data2 %>%
select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 174:Q30_6_Other) %>%
gather("q", "r", 7:Q30_6_Other)
with(Q30, table(q, r))
q30 <- Q30 %>%
count(q, r)
# Chunk 32
with(data2, summary(Q31))
# by gender
with(data2, by(Q31, PPGENDER, summary))
#
with(data2, by(Q31, PPETHM, summary))
#
with(data2, by(Q31, PPINCIMP, summary))
# Chunk 33
with(data2, summary(Q32))
# by gender
with(data2, by(Q32, PPGENDER, summary))
#
with(data2, by(Q32, PPETHM, summary))
#
with(data2, by(Q32, PPINCIMP, summary))
# Chunk 34
with(data2, summary(Q33))
# by gender
with(data2, by(Q33, PPGENDER, summary))
#
with(data2, by(Q31, PPETHM, summary))
#
with(data2, by(Q31, PPINCIMP, summary))
# Chunk 35
with(data2, table(Q35))
# Chunk 36
with(data2, summary(Q36))
# Chunk 37
with(data2, summary(Q37))
# Chunk 38
with(data2, summary(Q38))
# Chunk 39
with(data2, table(Q39))
# Chunk 40
with(data2, table(Q40))
# Chunk 41
with(data2, table(Q41))
# Chunk 42
with(data2, table(Q42))
# Chunk 43
with(data2, table(Q43))
# Chunk 44
with(data2, summary(Q44))
# Chunk 45
with(data2, summary(Q45))
# Chunk 46
with(data2, summary(Q46))
# Chunk 47
with(data2, table(Q47))
# Chunk 48
with(data2, table(Q48))
# Chunk 49
with(data2, table(Q49))
# Chunk 50
with(data2, table(Q50))
data1$PPETHM <- factor(data$PPETHM, levels = PPETHM.lab)
levels(data1$PPETHM)
