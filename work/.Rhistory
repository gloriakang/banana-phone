delays %>%
filter(n > 25) %>%
ggplot(aes(n, delay)) +
geom_point()
library(tidyr)
library(dplyr)
library(DSR)
install.packages("DSR")
library(DSR)
dplyr::select()
delays <- not_cancelled %>%
group_by(tailnum) %>%
summarise(
delay = mean(arr_delay), n()
)
source('~/Google Drive/rstudio/r4ds/4_data_transformation.R')
delays <- not_cancelled %>%
group_by(tailnum) %>%
summarise(
delay = mean(arr_delay), n()
)
delays
ggplot(delays, aes(delay)) +
geom_histogram(binwidth = 10)
delays <- not_cancelled %>%
group_by(tailnum) %>%
summarise(
delay = mean(arr_delay, na.rm = TRUE),
n = n()
)
ggplot(delays, aes(n, delay)) +
geom_point()
delays
install.packages(c("lazyeval", "plyr", "tidyr"))
install.packages("foreign")
install.packages("jsonlite")
install.packages("car")
??apply
??recode
data <- read.csv("surveydata.csv")
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(car)
# read data and names
data <- read.csv("surveydata.csv")
View(data)
testdata <- apply(data, 2, function(x) {x <- recode(x, "Male = 1; Female = 2"); x})
testdata <- apply(data, 2, function(x) {x <- recode(x, 'Male' = 1; 'Female' = 2); x})
testdata <- apply(data, 2, function(x) {x <- recode(x, "Male = 1; Female = 2"); x})
testdata <- apply(data, 2, function(x) {x <- recode(x, "Male = 1;Female = 2"); x})
testdata <- apply(data, 2, function(x) {x <- recode(x, "'Male' = 1; 'Female' = 2"); x})
setwd("~/git/banana-phone/work")
function (var, recodes, as.factor.result, as.numeric.result = TRUE,
testdata <- apply(data, 2, function(x) {x <- recode(x, "'Male' = 1; 'Female' = 2"); x})
class(testdata)
as.data.frame(testdata)
testdata = as.data.frame(testdata)
View(testdata)
testdata <- apply(data, 2, function(x)
{x <- recode(x, "'Male' = 1; 'Female' = 2"); x})
PPINCIMP
data$PPINCIMP
View(data$PPINCIMP)
data$PPINCIMP
unique(data$PPINCIMP)
levels(data$PPINCIMP)
a = levels(data$PPINCIMP)
a
testdata <- apply(data, 2, function(x)
{x <- recode(x,"
"Male" = 1; "Female" = 2;
"Less than $5,000" = 1;
"); x})
testdata <- apply(data, 2, function(x)
{x <- recode(x,"
"Male" = 1; "Female" = 2;
"); x})
testdata <- apply(data, 2, function(x)
{x <- recode(x,'
"Male" = 1; "Female" = 2;
'); x})
testdata
head(testdata)
View(testdata)
str(data$PPGENDER)
testdata <- apply(data, 2, function(x)
{x <- recode(x,'
"Male" = 1; "Female" = 2;
"Less than $5,000" = 1; "$5,000 to $7,499" = 2; "$7,500 to $9,999" = 3;
"$10,000 to $12,499" = 4; "$12,500 to $14,999" = 5; "$15,000 to $19,999" = 6;
"$20,000 to $24,999" = 7; "$25,000 to $29,999" = 8; "$30,000 to $34,999" = 9;
"$35,000 to $39,999" = 10; "$40,000 to $49,999" = 11; "$50,000 to $59,999" = 12;
"$60,000 to $74,999" = 13; "$75,000 to $84,999" = 14; "$85,000 to $99,999" = 15;
"$100,000 to $124,999" = 16; "$125,000 to $149,999" = 17; "$150,000 to $174,999" = 18;
"$175,000 or more" = 19
'); x})
levels(data$PPINCIMP)
levels(testdata$PPINCIMP)
class(testdata)
testdata = as.data.frame(testdata)
levels(testdata$PPINCIMP)
levels(testdata$PPGENDER)
data$PPGENDER
testdata$PPGENDER
str(testdata$PPGENDER)
str(data$PPGENDER)
str(data$PPINCIMP)
levels(data$PPINCIMP)
str(data$PPINCIMP)
levels(data)
is.factor(PPINCIMP)
is.factor(data$PPINCIMP)
str(data$Q11_1)
summary(data$Q11_1)
levels(data$Q11_1)
levels(data$PPINCIMP)
testdata$PPINCIMP
str(testdata$PPINCIMP)
levels(data$PPINCIMP) <- c("Less than $5,000",
"$5,000 to $7,499",
"$7,500 to $9,999",
"$10,000 to $12,499",
"$12,500 to $14,999",
"$15,000 to $19,999",
"$20,000 to $24,999",
"$25,000 to $29,999",
"$30,000 to $34,999",
"$35,000 to $39,999",
"$40,000 to $49,999",
"$50,000 to $59,999",
"$60,000 to $74,999",
"$75,000 to $84,999",
"$85,000 to $99,999",
"$100,000 to $124,999",
"$125,000 to $149,999",
"$150,000 to $174,999",
"$175,000 or more")
levels(data$PPINCIMP)
levels(data$Q11_1)
levels(data$Q11_1:Q11_10)
levels(data$Q11_1:data$Q11_10)
levels(data[Q11_1:Q11_10])
levels(data("Q11_1":"Q11_10"))
levels(data[,"Q11_1":"Q11_10"])
test <- apply(data, 2, function(x)
{x <- levels(x,'"Male" = 1; "Female" = 2'); x})
data %>%
levels(PPGENDER)
??levels
View(data)
is.ordered(data$ppagecat)
levels(data$PPINCIMP)
sort(data$PPINCIMP)
mixedsort(data$PPINCIMP)
reorder(data$PPINCIMP)
??reorder
levels(PPEDUCAT)
levels(data$PPEDUCAT)
sort(data$PPEDUCAT)
levels(data$PPEDUCAT)
as.integer(data$PPINCIMP)
f = factor(data$PPINCIMP)
F
f
as.integer(data$PPINCIMP)
is.factor(data$PPINCIMP)
a = as.integer(data$PPINCIMP)
Class(a)
class(a)
a
print(a)
summary(a)
str(a)
levels(data$ppagecat)
levels(data$ppagect4)
levels(data$PPEDUC)
levels(data$PPWORK)
levels(data$Q11_1)
data$Q1:Q2
data$Q1:data$Q2
data[Q1]
data['Q1']
data['Q1':'Q2']
data[Q1:Q2]
data[c(Q1:Q2)]
data[c('Q1':'Q2')]
data[, 1:2]
data[, Q1:Q2]
data[, 'Q1':'Q2']
data[, 'Q1']
data[, 'Q1':'Q2']
data[, c('Q1','Q2')]
data[, c('Q11_1','Q11_2', 'Q11_3', 'Q11_4', 'Q11_5')]
a = data[, c('Q11_1','Q11_2', 'Q11_3', 'Q11_4', 'Q11_5')]
levels(a)
str(a)
levels(data$Q11_1)
levels(data$Q11_1) <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know")
levels(data$Q11_1) <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
a <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
levels(data$Q11_2)
levels(data$Q11_2) <- a
levels(data$Q11_6, data$Q11_7) <- a
levels(data$Q11_6; data$Q11_7) <- a
levels(data$Q11_3) <- a
levels(data$Q11_4) <- a
levels(data$Q11_5) <- a
levels(data$Q11_6) <- a
levels(data$Q11_2) <- a
levels(data$Q11_11) <- a
levels(data$Q11_6) <- q11.level
levels(data$Q11_7) <- q11.level
q11.level <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
levels(data$Q11_2) <- q11.level
levels(data$Q11_3) <- q11.level
levels(data$Q11_4) <- q11.level
levels(data$Q11_5) <- q11.level
levels(data$Q11_6) <- q11.level
levels(data$Q11_7) <- q11.level
levels(data$Q11_8) <- q11.level
levels(data$Q11_9) <- q11.level
levels(data$Q11_10) <- q11.level
levels(data$Q11_11) <- q11.level
levels(data$Q12_1)
levels(data$Q18_1)
levels(data$Q15)
levels(data$Q16)
source('~/git/banana-phone/work/data_cleaning.R')
data1 <- write.csv(data, file = "surveydata1.csv", row.names = FALSE)
write.csv(data, file = "surveydata1.csv", row.names = FALSE)
data1 <- read.csv("surveydata1.csv")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
#library(foreign)
# weighted data
data <- read.csv("surveydata1.csv", na = c("#NULL!", "", "Refused"))
# renamed cols
data2 <- read.csv("surveydata2.csv", na = c("#NULL!", "", "Refused"))
# unweighted data -- what is the difference?
#data_unw <- read.csv("surveydata_unw.csv", na = c("#NULL!", ""))
#data_unw <- read.spss("datafile.sav", to.data.frame = TRUE)
# Q1 summary
with(data, table(Q1))
q1 <- data %>%
count(Q1)
# plot with this one
ggplot(data[!is.na(data$Q1), ]) + geom_bar(mapping = aes(x = Q1, fill = Q1))
# ggplot(q1, aes(x = Q1, y = n, fill = Q1)) + geom_bar(stat = 'identity')
# plot without na's
#ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
#  geom_bar(stat = 'identity', position = position_dodge())
# by gender, PPGENDER
with(data, table(PPGENDER, Q1))
q1 <- data %>%
count(Q1, PPGENDER)
# plot
ggplot(data[!is.na(data$Q1), ]) + geom_bar(mapping = aes(x = Q1, fill = PPGENDER), position = position_dodge())
# ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPGENDER)) +
#   geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPGENDER)
# by ethnicity, PPETHM
with(data, table(PPETHM, Q1))
q1 <- data %>%
count(Q1, PPETHM)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPETHM)) +
geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPETHM)
# by income, PPINCIMP
with(data, table(PPINCIMP, Q1))
q1 <- data %>%
count(Q1, PPINCIMP)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPINCIMP)) +
geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPINCIMP)
View(data1)
data1 <- read.csv("surveydata1.csv")
data <- read.csv("surveydata.csv")
levels(data$PPINCIMP) <- c("Less than $5,000",
"$5,000 to $7,499",
"$7,500 to $9,999",
"$10,000 to $12,499",
"$12,500 to $14,999",
"$15,000 to $19,999",
"$20,000 to $24,999",
"$25,000 to $29,999",
"$30,000 to $34,999",
"$35,000 to $39,999",
"$40,000 to $49,999",
"$50,000 to $59,999",
"$60,000 to $74,999",
"$75,000 to $84,999",
"$85,000 to $99,999",
"$100,000 to $124,999",
"$125,000 to $149,999",
"$150,000 to $174,999",
"$175,000 or more")
q11.level <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
levels(data$Q11_2) <- q11.level
levels(data$Q11_3) <- q11.level
levels(data$Q11_4) <- q11.level
levels(data$Q11_5) <- q11.level
levels(data$Q11_6) <- q11.level
levels(data$Q11_7) <- q11.level
levels(data$Q11_8) <- q11.level
levels(data$Q11_9) <- q11.level
levels(data$Q11_10) <- q11.level
levels(data$Q11_11) <- q11.level
View(data)
??write-csv
??write.csv
q11 <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
data$Q11_1 <- factor(data$Q11_1, levels = q11)
View(data)
data <- factor(data$Q11_1, levels = q11)
View(data)
data$Q11_1 <- factor(data$Q11_1, levels = q11)
data$Q11_2 <- factor(data$Q11_2, levels = q11)
q11
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(car)
# data
data <- read.csv("surveydata.csv")
q11 <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
data$Q11_1 <- factor(data$Q11_1, levels = q11)
data$Q11_2 <- factor(data$Q11_2, levels = q11)
View(data)
PPINCIMP <- c("Less than $5,000",
"$5,000 to $7,499",
"$7,500 to $9,999",
"$10,000 to $12,499",
"$12,500 to $14,999",
"$15,000 to $19,999",
"$20,000 to $24,999",
"$25,000 to $29,999",
"$30,000 to $34,999",
"$35,000 to $39,999",
"$40,000 to $49,999",
"$50,000 to $59,999",
"$60,000 to $74,999",
"$75,000 to $84,999",
"$85,000 to $99,999",
"$100,000 to $124,999",
"$125,000 to $149,999",
"$150,000 to $174,999",
"$175,000 or more")
data$PPINCIMP <- factor(data$PPINCIMP, levels = PPINCIMP)
write.csv(data, file = "surveydata1.csv", row.names = FALSE)
data1 <- read.csv("surveydata1.csv")
View(data1)
f <- function(x) {
if(is.factor(x)) {
return(as.numeric(x))
} else {
return(x)
}
df <- sapply(f,df)
df <- sapply(f,data)
data <- sapply(f,data)
data1 <- sapply(f,data)
setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(car)
# data
data <- read.csv("surveydata.csv")
PPINCIMP <- c("Less than $5,000",
"$5,000 to $7,499",
"$7,500 to $9,999",
"$10,000 to $12,499",
"$12,500 to $14,999",
"$15,000 to $19,999",
"$20,000 to $24,999",
"$25,000 to $29,999",
"$30,000 to $34,999",
"$35,000 to $39,999",
"$40,000 to $49,999",
"$50,000 to $59,999",
"$60,000 to $74,999",
"$75,000 to $84,999",
"$85,000 to $99,999",
"$100,000 to $124,999",
"$125,000 to $149,999",
"$150,000 to $174,999",
"$175,000 or more")
data$PPINCIMP <- factor(data$PPINCIMP, levels = PPINCIMP)
levels(data$PPINCIMP)
q11 <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
data$Q11_1 <- factor(data$Q11_1, levels = q11)
data$Q11_2 <- factor(data$Q11_2, levels = q11)
data1 = data
data1 <- data
PPINCIMP <- c("Less than $5,000",
"$5,000 to $7,499",
"$7,500 to $9,999",
"$10,000 to $12,499",
"$12,500 to $14,999",
"$15,000 to $19,999",
"$20,000 to $24,999",
"$25,000 to $29,999",
"$30,000 to $34,999",
"$35,000 to $39,999",
"$40,000 to $49,999",
"$50,000 to $59,999",
"$60,000 to $74,999",
"$75,000 to $84,999",
"$85,000 to $99,999",
"$100,000 to $124,999",
"$125,000 to $149,999",
"$150,000 to $174,999",
"$175,000 or more")
data1$PPINCIMP <- factor(data$PPINCIMP, levels = PPINCIMP
)
levels(data1$PPINCIMP)
q11 <- c("High Risk, Very Likely", "Medium Risk, Somewhat Likely",
"Low Risk, Not Likely", "Don_t Know", "Refused")
data1$Q11_1 <- factor(data$Q11_1, levels = q11)
data1$Q11_2 <- factor(data$Q11_2, levels = q11)
f <- function(x) {
if(is.factor(x)) {
return(as.numeric(x))
} else {
return(x)
}
View(f)
data1 <- sapply(f,data1)
View(f)
f <- function(x) {
if(is.factor(x)) {
return(as.character(x))
} else {
return(x)
}
data1 <- sapply(f,data1)
data1 <- data
data1 <- sapply(f,data1)
data1 <- sapply(f,data)
data <- sapply(f,data)
data <- sapply(f,data1)
data <- sapply(f,data)
data1 <- data
data1 = data
data1 = as.data.frame(data)
View(data1)
data <- read.csv("surveydata.csv")
View(data)
PPINCIMP <- c("Less than $5,000",
"$5,000 to $7,499",
"$7,500 to $9,999",
"$10,000 to $12,499",
"$12,500 to $14,999",
"$15,000 to $19,999",
"$20,000 to $24,999",
"$25,000 to $29,999",
"$30,000 to $34,999",
"$35,000 to $39,999",
"$40,000 to $49,999",
"$50,000 to $59,999",
"$60,000 to $74,999",
"$75,000 to $84,999",
"$85,000 to $99,999",
"$100,000 to $124,999",
"$125,000 to $149,999",
"$150,000 to $174,999",
"$175,000 or more")
data$PPINCIMP <- factor(data$PPINCIMP, levels = PPINCIMP)
levels(data$PPINCIMP)
data$Q11_1 <- factor(data$Q11_1, levels = q11)
data$Q11_2 <- factor(data$Q11_2, levels = q11)
f <- function(x) {
if(is.factor(x)) {
return(as.character(x))
} else {
return(x)
}
data <- sapply(f,data)
f <- function(x) {
if(is.factor(x)) {
return(as.numeric(x))
} else {
return(x)
}
data <- sapply(f,data)
sapply(f,data)
write.csv(data, file = "surveydata1.csv", row.names = FALSE)
data1 <- read.csv("surveydata1.csv")
View(data1)
write.csv(data, file = "surveydata1.csv", row.names = FALSE)
data1 <- read.csv("surveydata1.csv")
View(data1)
