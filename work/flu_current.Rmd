---
title: "Working report"
output:
  html_document:
    fig_caption: yes
    fig_height: 4
    highlight: tango
    theme: cosmo
    toc: yes
  pdf_document:
    fig_caption: yes
    fig_height: 3.5
    fig_width: 7
    toc: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)


setwd("~/git/banana-phone/work")
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
#library(foreign)

# weighted data
data <- read.csv("surveydata.csv", na = c("#NULL!", "", "Refused"))
# renamed cols
data2 <- read.csv("surveydata2.csv", na = c("#NULL!", "", "Refused"))
# unweighted data -- what is the difference?
#data_unw <- read.csv("surveydata_unw.csv", na = c("#NULL!", ""))
#data_unw <- read.spss("datafile.sav", to.data.frame = TRUE)
```

#### Working analysis

```{r, eval=FALSE, include=FALSE}
# Q1 proportions
with(data, prop.table(table(Q1)))

# Q1 and GENDER
with(data, table(Q1, PPGENDER))
with(data, prop.table(table(PPGENDER, Q1), margin = 1))
with(data, prop.table(table(PPGENDER, Q1), margin = 2))


# Q1 and Q2 counts
#with(data, by(Q1, Q2, summary))
with(data, table(Q1, Q2))

# Q1 and Q2 proportions
with(data, prop.table(table(Q1, Q2)))
with(data, prop.table(table(Q1, Q2), margin = 1))
with(data, prop.table(table(Q1, Q2), margin = 2))


# sick
sick <- filter(data, Q2=='Yes')

# sick and getting flu vaccine
with(sick, table(Q13))
with(data, table(Q2, Q13))


# perceived risk
with(Q11, table(q, r))

# high risk 
risk <- Q11 %>%
  filter(r=='High Risk, Very Likely')



```


```{r, eval=FALSE, include=FALSE}
# Q7.
with(Q7, table(q, r))

# Q7. and gender
with(Q7, table(q, r, PPGENDER))



# Q33. How many people, including yourself, reside in your household?
with(data, summary(Q33))
ggplot(data, aes(x = Q33)) + geom_histogram(binwidth = 2)

# ethnicity
with(data, by(Q33, PPETHM, summary))
ggplot(data, aes(x = PPETHM, y = Q33)) + geom_boxplot() + coord_flip()


# Q2 those infected + Q3 HHC infected
with(data, table(Q2, Q3))
# by gender
test <- filter(data, Q2=='Yes', Q3=='Yes')
with(test, table(PPGENDER))


# chi square?
summary(with(data, table(Q2, Q3)))
with(data, table(Q2))

# remake table?
testq2 <- c(rep("Yes", 385), rep("No", 1598))
testq3 <- c(rep("Yes", 236), rep("No", 149), rep("Yes", 145), rep("No",1453))
table(testq2, testq3)
summary(table(testq2, testq3))
```


```{r, eval=FALSE, include=FALSE}
### using psych package ###
a <- describe(data)
View(a)


```




# Survey questions
### Q1. Before receiving this survey, did you know influenza is different from the stomach flu?

```{r}
# Q1 summary
with(data, table(Q1))
(
q1 <- data %>%
  count(Q1)
)
# plot
ggplot(q1, aes(x = Q1, y = n, fill = Q1)) + geom_bar(stat = 'identity')

# plot without na's
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
  geom_bar(stat = 'identity', position = position_dodge())



# by gender, PPGENDER
with(data, table(PPGENDER, Q1))
(
q1 <- data %>%
  count(Q1, PPGENDER)
)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge())

# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPGENDER)



# by ethnicity, PPETHM
with(data, table(PPETHM, Q1))
(
q1 <- data %>%
  count(Q1, PPETHM)
)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPETHM)



# by income, PPINCIMP
with(data, table(PPINCIMP, Q1))
(
q1 <- data %>%
  count(Q1, PPINCIMP)
)
# plot
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge())
# plot with facet
ggplot(q1[!is.na(q1$Q1), ], aes(x = Q1, y = n, fill = Q1)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~PPINCIMP)

```

### Q2. Have you had an illness with influenza-like symptoms since August 2015?

```{r}
#
with(data, table(Q2))
(
q2 <- data %>%
  count(Q2)
)
ggplot(q2, aes(x = Q2, y = n, fill = Q2)) + geom_bar(stat = 'identity')


# by gender
with(data, table(Q2, PPGENDER))
(
q2 <- data %>%
  count(Q2, PPGENDER)
)
ggplot(q2, aes(x = Q2, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by ethnicity
with(data, table(Q2, PPETHM))
q2 <- data %>%
  count(Q2, PPETHM)
ggplot(q2, aes(x = Q2, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by income
with(data, table(Q2, PPINCIMP))
q2 <- data %>%
  count(Q2, PPINCIMP)
ggplot(q2, aes(x = Q2, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge())
```

### Q3. Has any other person in your household had an illness with influenza like symptoms since August 2015?

```{r}
# all
with(data, table(Q3))
q3 <- data %>%
  count(Q3)
ggplot(q3, aes(x = Q3, y = n, fill = Q3)) + geom_bar(stat = 'identity')

# by gender
with(data, table(Q3, PPGENDER))
q3 <- data %>%
  count(Q3, PPGENDER)
ggplot(q3, aes(x = Q3, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by ethnicity
with(data, table(Q3, PPETHM))
q3 <- data %>%
  count(Q3, PPETHM)
ggplot(q3, aes(x = Q3, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by income
with(data, table(Q3, PPINCIMP))
q3 <- data %>%
  count(Q3, PPINCIMP)
ggplot(q3, aes(x = Q3, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge())
```

### Q4. Does your job require you to have a lot of contact with the public?

```{r}
# all
with(data, table(Q4))
(
q4 <- data %>%
  count(Q4)
)
ggplot(q4, aes(x = Q4, y = n, fill = Q4)) + geom_bar(stat = 'identity')


# by gender
with(data, table(Q4, PPGENDER))
q4 <- data %>%
  count(Q4, PPGENDER)
ggplot(q4, aes(x = Q4, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge())


# by ethnicity
with(data, table(Q4, PPETHM))
q4 <- data %>%
  count(Q4, PPETHM)
ggplot(q4, aes(x = Q4, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge())


# by income 
with(data, table(Q4, PPINCIMP))
q4 <- data %>%
  count(Q4, PPINCIMP)
ggplot(q4, aes(x = Q4, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge())
```

### Q5. Do you have a car that you can use to travel to work?

```{r}
# all
with(data, table(Q5))
q5 <- data %>%
  count(Q5)
ggplot(q5, aes(x = Q5, y = n, fill = Q5)) + geom_bar(stat = 'identity')

# by gender
with(data, table(PPGENDER, Q5))
q5 <- data %>%
  count(Q5, PPGENDER)
ggplot(q5, aes(x = Q5, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by ethnicity 
q5 <- data %>%
  count(Q5, PPETHM)
ggplot(q5, aes(x = Q5, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by income 
q5 <- data %>%
  count(Q5, PPINCIMP)
ggplot(q5, aes(x = Q5, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge())
```

### Q6. Do you regularly use public transportation?

```{r}
# all
with(data, table(Q6))
q6 <- data %>%
  count(Q6)
ggplot(q6, aes(x = Q6, y = n, fill = Q6)) + geom_bar(stat = 'identity')

# by gender
# with(data, table(PPGENDER, Q6))
(q6 <- data %>%
  count(Q6, PPGENDER)
)
ggplot(q6, aes(x = Q6, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by ethnicity 
(q6 <- data %>%
  count(Q6, PPETHM)
)
ggplot(q6, aes(x = Q6, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge())

# by income 
(q6 <- data %>%
  count(Q6, PPINCIMP)
)
ggplot(q6, aes(x = Q6, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge())
```


### Q7. What types of public transportation do you regularly use?


```{r}
Q7 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q7_1_Bus:Q7_otherText) %>%
  gather("q", "r", Q7_1_Bus:Q7_7_Other)

# Q7
with(Q7, table(q, r))
q7 <- Q7 %>%
  count(q, r)

ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = r)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)


# by gender
# with(Q7, table(PPGENDER, r, q))
(q7 <- Q7 %>%
  group_by(PPGENDER, q, r) %>%
  count(PPGENDER, q, r)
)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)

# by ethnicity
# with(Q7, table(PPETHM, r, q))
(q7 <- Q7 %>%
  group_by(PPETHM, q, r) %>%
  count(PPETHM, q, r)
)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)

# by income
# with(Q7, table(q, r, PPINCIMP))
(q7 <- Q7 %>%
  group_by(PPINCIMP, q, r) %>%
  count(PPINCIMP, q, r)
)
ggplot(q7[!is.na(q7$r), ], aes(x = r, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)
```

#### Q8. For what types of activities do you regularly use public transportation?

```{r}
Q8 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q8_1_Work:Q8_otherText) %>%
  gather("q", "r", Q8_1_Work:Q8_6_Other)

with(Q8, table(q, r))
q8 <- Q8 %>%
  count(q, r)

```

#### Q9. Do other members of your household regularly use public transportation?
```{r}
with(data, table(Q9))


```

#### Q10. What types of public transportation do other members of your household regularly use?

```{r}
Q10 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q10_1_Bus:Q10_9_Refused) %>%
  gather("q", "r", Q10_1_Bus:Q10_8_Other)

with(Q10, table(q, r))
q10 <- Q10 %>%
  count(q, r)

```


#### Q11. How do you rate your risk of getting influenza if you visited each of the following locations?

```{r}
Q11 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q11_1_Work:Q11_OtherText_Codes) %>%
  gather("q", "r", Q11_1_Work:Q11_11_Other)


# all
with(Q11, table(q, r))
q11 <- Q11 %>%
  count(q, r)

ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = r)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)

# by gender
# with(Q7, table(PPGENDER, r, q))
(q11 <- Q11 %>%
  group_by(PPGENDER, q, r) %>%
  count(PPGENDER, q, r)
)
ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = PPGENDER)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)

# by ethnicity
# with(Q7, table(PPETHM, r, q))
(q11 <- Q11 %>%
  group_by(PPETHM, q, r) %>%
  count(PPETHM, q, r)
)
ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = PPETHM)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)

# by income
# with(Q7, table(q, r, PPINCIMP))
(q11 <- Q11 %>%
  group_by(PPINCIMP, q, r) %>%
  count(PPINCIMP, q, r)
)
ggplot(q11[!is.na(q11$r), ], aes(x = r, y = n, fill = PPINCIMP)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~q)


```

#### Q12. Which of the following actions do you take to avoid getting sick?

```{r}
Q12 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, 75:91) %>%
  gather("q", "r", Q12_1_Avoid.touching.my.eyes:Q12_15_Other)

with(Q12, table(q, r))
q12 <- Q12 %>%
  count(q, r)

```

#### Q13. Do you get the flu vaccine?
```{r}
with(data, table(Q13))

```

#### Q14. How much do you pay to get an influenza vaccine?
```{r}
with(data, table(Q14))

# by gender
with(data, by(Q14, PPGENDER, summary))

```

#### Q15. Are you more likely to get a vaccine if others around you get a vaccine?
```{r}
with(data, table(Q15))

```

#### Q16. Are you more likely to get a vaccine if others around you do not get a vaccine?

```{r}
with(data, table(Q16))

```

#### Q17. Do you get a vaccine to protect yourself, protect others, or protect yourself and others?

```{r}
with(data, table(Q17))

```

#### Q18. What are the reasons you would not get an influenza vaccine?



```{r}
Q18 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q18_1_The.vaccine.costs.too.much:Q18_11_Refused) %>%
  gather("q", "r", Q18_1_The.vaccine.costs.too.much:Q18_10_Other)

with(Q18, table(q, r))
q18 <- Q18 %>%
  count(q, r)
```

#### Q19. Do you have health insurance?

```{r}
with(data, table(Q19))

```
#### Q20. How effective do you think the influenza vaccine is in protecting people from becoming sick with influenza?

```{r}
with(data, table(Q20))

```
#### Q21. Are influenza vaccines covered by your health insurance?

```{r}
with(data, table(Q21))

```

#### Q22. Do you do any of the following when you have influenza symptoms?

```{r}
Q22 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q22_1_Go.to.a.doctor_s.office.or.medical.clinic:Q22_9_Other) %>%
  gather("q", "r", Q22_1_Go.to.a.doctor_s.office.or.medical.clinic:Q22_9_Other)

with(Q22, table(q, r))
q22 <- Q22 %>%
  count(q, r)

```

#### Q23. Which of the following actions do you take when you have influenza symptoms to avoid someone else from getting sick?

```{r}
Q23 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q23_1_Stand.away.from.people:Q23_11_Other) %>%
  gather("q", "r", Q23_1_Stand.away.from.people:Q23_11_Other)

with(Q23, table(q, r))
q23 <- Q23 %>%
  count(q, r)

```

#### Q24. What sources of information do you recall hearing or seeing about influenza outbreaks? 



```{r}
Q24 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q24_1_Print.media.such.as.newspapers.and.magazines:Q24_7_Refused) %>%
  gather("q", "r", Q24_1_Print.media.such.as.newspapers.and.magazines:Q24_6_Other)

with(Q24, table(q, r))
q24 <- Q24 %>%
  count(q, r)
```

#### Q25. If you received information from the news, internet or other public media that there was an influenza outbreak in your community would you do any of the following?

```{r}
Q25 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q25_1_Stand.away.from.people:Q25_11_Other) %>%
  gather("q", "r", Q25_1_Stand.away.from.people:Q25_11_Other)

with(Q25, table(q, r))
q25 <- Q25 %>%
  count(q, r)

```

#### Q26. Does your household have children?
```{r}
with(data, table(Q26))

```
#### Q27. What actions do you take when a child in your household has influenza symptoms?


```{r}
Q27 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q27_1_Keep.the.child.away.from.the.others.in.the.residence:Q27_4_Other) %>%
  gather("q", "r", Q27_1_Keep.the.child.away.from.the.others.in.the.residence:Q27_4_Other)

with(Q27, table(q, r))
q27 <- Q27 %>%
  count(q, r)
```

#### Q28. Are you a single parent?
```{r}
with(data, table(Q28))

```
#### Q29. How do you care for a sick child?



```{r}
Q29 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q29_1_A.parent.brings.the.child.to.work:Q29_6_Other) %>%
  gather("q", "r", Q29_1_A.parent.brings.the.child.to.work:Q29_6_Other)

with(Q29, table(q, r))
q29 <- Q29 %>%
  count(q, r)
```

#### Q30. How do you care for a sick child?

```{r}
Q30 <- data2 %>%
  select(PPGENDER, PPAGE, PPEDUC, PPETHM, PPINCIMP, PPWORK, Q30_1_I.bring.the.child.to.work:Q30_6_Other) %>%
  gather("q", "r", Q30_1_I.bring.the.child.to.work:Q30_6_Other)

with(Q30, table(q, r))
q30 <- Q30 %>%
  count(q, r)

```

#### Q31. How many hours of screen time (time spent watching television, a computer, smartphone, iPad, etc.) do you spend each day on average when you are not sick? Enter 0 if none

```{r}
with(data, summary(Q31))

# by gender
with(data, by(Q31, PPGENDER, summary))

```

#### Q32. How many hours of screen time do you spend each day on average when you are sick? Enter 0 if none

```{r}
with(data, summary(Q32))

# by gender
with(data, by(Q33, PPGENDER, summary))

```

#### Q33. How many people, including yourself, reside in your household?

```{r}
with(data, summary(Q33))

# by ethnicity
with(data, by(Q33, PPETHM, summary))

```



# Household Members

## HHM1

#### Q35. What is the gender of this member of the household?  Remember, this relates to HHM1_Name who is HHM1_AGE years old.

```{r}
with(data, table(Q35))

```

#### Q36. On average, how many days per week does this member of your household work or attend day care or school outside of your home?

```{r}
with(data, summary(Q36))

```

#### Q37. On average, how many days per week does this member of your household participate in social activities outside of your home?

```{r}
with(data, summary(Q37))

```

#### Q38. On average, how many days per week does this member of your household use public transportation?

```{r}
with(data, summary(Q38))

```

#### Q39. How frequently does this member of your household visit a doctor's office for wellness appointments?

```{r}
with(data, summary(Q39))

```

#### Q40. How frequently does this member of the household get sick in a typical year?

```{r}
with(data, summary(Q40))

```

#### Q41. How many times has this member of your household had influenza or another respiratory illness in the last two years?

```{r}
with(data, summary(Q41))

```

#### Q42. Does this member of your household get an annual influenza vaccine?

```{r}
with(data, summary(Q42))

```


## HHM2

#### Q43. What is the gender of this member of the household?  Remember, this relates to HHM1_Name who is HHM1_AGE years old.

```{r}
with(data, summary(Q43))

```


#### Q44. On average, how many days per week does this member of your household work or attend day care or school outside of your home?

```{r}
with(data, summary(Q44))

```

#### Q45. On average, how many days per week does this member of your household participate in social activities outside of your home?

```{r}
with(data, summary(Q45))

```

#### Q46. On average, how many days per week does this member of your household use public transportation?

```{r}
with(data, summary(Q46))

```

#### Q47. How frequently does this member of your household visit a doctor's office for wellness appointments?

```{r}
with(data, summary(Q47))

```

#### Q48. How frequently does this member of the household get sick in a typical year?

```{r}
with(data, summary(Q48))

```

#### Q49. How many times has this member of your household had influenza or another respiratory illness in the last two years?
```{r}
with(data, summary(Q49))

```

#### Q50. Does this member of your household get an annual influenza vaccine?
```{r}
with(data, summary(Q50))

```










